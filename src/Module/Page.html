
<!DOCTYPE html>
<html>
<head>
    <base target="_top">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <style>
        #spinner {
          display: none;
          background-color: tomato;
          position: absolute;
          top: 1%;
          width: 100%;
          justify-items: center;
        }
      </style>

</head>
<body>
<div class="p-3">

    <!-- ******* Project ****** -->
    <div class="block form-group">
        <label for="project" class='textarea'><b>Projet</b></label>
        <? 
        var main = new Main();
        var project = JSON.parse(main.properties._project) ?>
        <p class='h4'><?= project.label ?></p>
    </div>
    <!-- ******* Phase ****** -->
    <div class="btn mb-3">
        <label for="phases"><b>Phase du projet</b></label>
        <select class="form-select form-select-lg mb-3" name="phases" id="phases" onChange="getSelectedValue('phases')">
        <option value={null}>Selectionner une phase</option>
        <? 
        var phases = JSON.parse(main.properties._phases);
        for (var i = 0; i < phases.length; i++) { ?>
        <option value="<?= i ?>"><?= phases[i].label ?></option>
        <? } ?>
        </select>
    </div>


    <? if(main.properties._activity !== 'undefined'){?>
        <?!= setActivityHTML() ?>
    <? } ?>
    <div id="spinner"><p>Loading modal dialog...</p></div>

    <button type="button" class="btn btn-primary" id="refresh" onclick ="google.script.run.withSuccessHandler(refreshApp).getNewHtml()">
    Continuer
    </button>

    <div id="loader"></div>
    <script>
        function getSelectedValue(type){
            var div = document.getElementById('loader');
            div.innerHTML = 'Loading...'
            var select = document.getElementById(type);
            var value = select.options[select.selectedIndex].value
            var text = select.options[select.selectedIndex].text
            type === "phases" ? google.script.run.withSuccessHandler(loader).setPhases(value,text) : google.script.run.withSuccessHandler(loader).setActivity(value,text)

        }

        function refreshApp(newHtml) {
        document.open();
        document.write(newHtml);
        document.close();
      }

      function loader(){
        var div = document.getElementById('loader');
            div.innerHTML = ''
      }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
</div>
</body>
</html>